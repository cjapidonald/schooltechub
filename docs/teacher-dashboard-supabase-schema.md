# Teacher Workspace Supabase Schema

The following schema powers the SchoolTech Hub teacher dashboard. It keeps lesson planning, calendar scheduling, class collaboration, blogs, and teacher queries organized in a single Supabase project. All tables use UUID primary keys unless stated otherwise.

## Core People & Classes

### `teachers`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key linked to `auth.users.id`. |
| `full_name` | `text` | Teacher display name. |
| `school_name` | `text` | Optional school affiliation. |
| `avatar_url` | `text` | Optional avatar stored in Supabase storage. |
| `created_at` | `timestamptz` | Defaults to `now()`. |
| `updated_at` | `timestamptz` | Updated via trigger. |

### `students`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | Owner, references `teachers.id`. |
| `first_name` | `text` | Student first name. |
| `last_name` | `text` | Student last name. |
| `email` | `text` | Optional guardian/student email. |
| `notes` | `text` | Private teacher notes. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `student_behavior_logs`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `student_id` | `uuid` | References `students.id`. |
| `class_id` | `uuid` | Optional reference to `classes.id`. |
| `note` | `text` | Behaviour observation or context. |
| `sentiment` | `text` | Enum: `positive`, `neutral`, `needs_support`. |
| `recorded_by` | `uuid` | Teacher author, references `teachers.id`. |
| `recorded_at` | `timestamptz` | Defaults to `now()`. |

### `student_appraisals`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `student_id` | `uuid` | References `students.id`. |
| `class_id` | `uuid` | Optional reference to `classes.id`. |
| `highlight` | `text` | Celebration or note about achievement. |
| `recorded_by` | `uuid` | Teacher author, references `teachers.id`. |
| `recorded_at` | `timestamptz` | Defaults to `now()`. |

### `classes`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | Owner, references `teachers.id`. |
| `title` | `text` | Class name (e.g., "Grade 5 Science"). |
| `description` | `text` | Optional overview. |
| `color` | `text` | Hex color used in UI. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `class_members`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `class_id` | `uuid` | References `classes.id`. |
| `student_id` | `uuid` | References `students.id`. |
| `enrolled_on` | `date` | Enrollment date. |
| `role` | `text` | Defaults to `'student'`. |

## Lesson Planning & Calendar

### `lesson_plans`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `class_id` | `uuid` | Optional reference to `classes.id`. |
| `title` | `text` | Lesson title. |
| `objective` | `text` | Learning objective or summary. |
| `content` | `jsonb` | Structured lesson sections (warm-up, instruction, assessment, etc.). |
| `scheduled_for` | `date` | When the lesson should occur. |
| `duration_minutes` | `integer` | Optional duration. |
| `status` | `text` | Enum: `draft`, `scheduled`, `completed`. |
| `created_at` | `timestamptz` | Defaults to `now()`. |
| `updated_at` | `timestamptz` | Updated via trigger. |

### `lesson_plan_resources`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `lesson_plan_id` | `uuid` | References `lesson_plans.id`. |
| `title` | `text` | Resource name. |
| `type` | `text` | Enum: `link`, `file`, `note`. |
| `url` | `text` | Link to resource or storage path. |
| `metadata` | `jsonb` | Additional info (e.g., file size). |

### `calendar_events`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `lesson_plan_id` | `uuid` | Optional reference to `lesson_plans.id`. |
| `title` | `text` | Event name. |
| `starts_at` | `timestamptz` | Event start. |
| `ends_at` | `timestamptz` | Event end. |
| `type` | `text` | Enum: `lesson`, `meeting`, `reminder`. |
| `notes` | `text` | Additional context. |
| `source` | `text` | Auto-filled with `'lesson-plan'` when generated by trigger. |

> **Automation tip:** Create an `AFTER INSERT OR UPDATE` trigger on `lesson_plans` that inserts/updates the matching `calendar_events` row whenever `scheduled_for` changes. This keeps the teaching calendar synchronized automatically.

## Student Progress Tracking

### `progress_metrics`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `title` | `text` | Metric label (e.g., "Participation"). |
| `description` | `text` | Optional guidance. |
| `weight` | `numeric` | Optional weighting for analytics. |

### `student_progress_entries`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `student_id` | `uuid` | References `students.id`. |
| `class_id` | `uuid` | References `classes.id`. |
| `lesson_plan_id` | `uuid` | Optional reference to `lesson_plans.id`. |
| `metric_id` | `uuid` | References `progress_metrics.id`. |
| `value` | `numeric` | Score or completion percentage. |
| `note` | `text` | Reflection or qualitative feedback. |
| `recorded_at` | `timestamptz` | Defaults to `now()`. |

### `student_reports`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `student_id` | `uuid` | References `students.id`. |
| `requested_by` | `uuid` | Teacher requesting report. |
| `status` | `text` | Enum: `pending`, `processing`, `ready`, `failed`. |
| `generated_url` | `text` | Optional link to generated document. |
| `requested_at` | `timestamptz` | Defaults to `now()`. |
| `completed_at` | `timestamptz` | Set when report is ready. |

## Content Publishing & Resources

### `resources`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `title` | `text` | Resource headline. |
| `description` | `text` | Summary for quick scanning. |
| `category` | `text` | Enum: `handout`, `video`, `template`, `blog`. |
| `content` | `jsonb` | Rich text or structured data. |
| `published` | `boolean` | Indicates if visible to others. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `blog_posts`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `title` | `text` | Blog title. |
| `slug` | `text` | Unique slug for routing. |
| `excerpt` | `text` | Preview text. |
| `content` | `jsonb` | Blog body stored as rich text. |
| `status` | `text` | Enum: `draft`, `scheduled`, `published`. |
| `published_at` | `timestamptz` | Optional publication timestamp. |

### `blog_post_tags`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `blog_post_id` | `uuid` | References `blog_posts.id`. |
| `tag` | `text` | Individual tag value. |

### `saved_posts`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `user_id` | `uuid` | References `teachers.id`/`auth.users.id`. |
| `post_id` | `uuid` | References `blog_posts.id`. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

## Teacher Queries & Collaboration

### `queries`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | Author, references `teachers.id`. |
| `class_id` | `uuid` | Optional reference to `classes.id`. |
| `title` | `text` | Question or topic headline. |
| `body` | `text` | Full query text. |
| `status` | `text` | Enum: `open`, `resolved`, `archived`. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `query_replies`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `query_id` | `uuid` | References `queries.id`. |
| `teacher_id` | `uuid` | Author, references `teachers.id`. |
| `body` | `text` | Reply text. |
| `is_answer` | `boolean` | Marks the reply as the accepted solution. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `query_reactions`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `reply_id` | `uuid` | References `query_replies.id`. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `reaction` | `text` | Enum: `upvote`, `insightful`, `bookmark`. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

## Automation Helpers

### `dashboard_settings`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `research_opt_in` | `boolean` | Mirrors UI toggle for research notifications. |
| `default_class_id` | `uuid` | Optional default selection for new lesson plans. |
| `timezone` | `text` | Sets calendar timezone. |

### `activity_log`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `teacher_id` | `uuid` | References `teachers.id`. |
| `action` | `text` | Enum: `lesson_created`, `calendar_updated`, `query_posted`, etc. |
| `metadata` | `jsonb` | Context payload. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `curriculum_items`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `class_id` | `uuid` | References `classes.id`. |
| `title` | `text` | Lesson or unit title. |
| `topic` | `text` | Focus area for the week. |
| `stage` | `text` | Curriculum stage or key stage. |
| `subject` | `text` | Subject name. |
| `week` | `integer` | Term week number. |
| `date` | `date` | Scheduled delivery date. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `curriculum_lessons`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `curriculum_item_id` | `uuid` | References `curriculum_items.id`. |
| `lesson_plan_id` | `uuid` | References `lesson_plans.id`. |
| `status` | `text` | Enum: `draft`, `published`, `archived`. |
| `view_url` | `text` | Optional link to public view. |
| `created_at` | `timestamptz` | Defaults to `now()`. |

### `assessments`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `class_id` | `uuid` | References `classes.id`. |
| `title` | `text` | Assessment title. |
| `description` | `text` | Instructions or guidance. |
| `due_date` | `date` | Optional due date. |
| `grading_scale` | `text` | Enum: `letter`, `percentage`, `points`, `rubric`. |
| `created_at` | `timestamptz` | Defaults to `now()`. |
| `updated_at` | `timestamptz` | Updated via trigger. |

### `assessment_submissions`
| Column | Type | Description |
| --- | --- | --- |
| `id` | `uuid` | Primary key. |
| `assessment_id` | `uuid` | References `assessments.id`. |
| `student_id` | `uuid` | References `students.id`. |
| `status` | `text` | Enum: `not_started`, `in_progress`, `submitted`. |
| `submitted_at` | `timestamptz` | Timestamp of submission. |
| `attachments` | `jsonb` | Array of uploaded artefacts. |

## Suggested Views & Policies

- Create a `dashboard_overview` view that aggregates counts for lessons, classes, and queries per teacher for fast loading on the homepage.
- Apply Row Level Security with policies scoping all tables by `teacher_id = auth.uid()` so each educator only sees their own workspace data.
- Enable realtime on `lesson_plans`, `calendar_events`, and `queries` to broadcast updates across sessions.

This schema covers all features described in the teacher dashboard: lesson plan creation, automatic calendar syncing, class management, student progress tracking, blogs/resources, and collaborative query boards.
